<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SS Fantasy Football</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #121212; color: white; }
    .pitch-green { color: #00E676; }
    .bg-pitch-green { background-color: #00E676; }
    .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="antialiased">
  <div id="root"></div>

  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import * as Lucide from 'https://esm.sh/lucide-react@0.263.1';

    // --- FIREBASE CONFIG ---
    const firebaseConfig = { databaseURL: "https://mylocalfantasy-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- APP COMPONENT ---
    function App() {
      const [user, setUser] = useState(JSON.parse(localStorage.getItem('fantasy_user')));
      const [tId, setTId] = useState(localStorage.getItem('active_t_id'));
      const [view, setView] = useState('pitch'); // pitch, draft, fixtures, stats, admin
      const [tData, setTData] = useState(null);

      useEffect(() => {
        if (tId) {
          const tRef = ref(db, `tournaments/${tId}`);
          onValue(tRef, (snapshot) => { setTData(snapshot.val()); });
        }
      }, [tId]);

      const logout = () => {
        localStorage.clear();
        setUser(null);
        setTId(null);
        window.location.reload();
      };

      // 1. LOGIN SCREEN
      if (!user) return React.createElement(LoginView, { onLogin: (u) => { setUser(u); localStorage.setItem('fantasy_user', JSON.stringify(u)); } });

      // 2. GATEWAY SCREEN
      if (!tId) return React.createElement(GatewayView, { user, onJoin: (id) => { setTId(id); localStorage.setItem('active_t_id', id); } });

      // 3. MAIN APP
      return React.createElement('div', { className: 'min-h-screen pb-24' },
        // Header
        React.createElement('header', { className: 'p-4 bg-white/5 border-b border-white/10 flex justify-between items-center' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'font-black uppercase italic text-[#00E676]' }, tData?.name || 'Loading...'),
            React.createElement('p', { className: 'text-[10px] text-white/40 tracking-widest' }, 'CHIP: #' + tId)
          ),
          React.createElement('div', { className: 'flex gap-2' },
            React.createElement('button', { onClick: () => setView('admin'), className: 'p-2 bg-white/5 rounded-lg' }, React.createElement(Lucide.Settings, { size: 18 })),
            React.createElement('button', { onClick: logout, className: 'p-2 bg-white/5 rounded-lg' }, React.createElement(Lucide.LogOut, { size: 18 }))
          )
        ),
        // Content View
        React.createElement('main', { className: 'p-4 max-w-2xl mx-auto' },
          view === 'pitch' && React.createElement(PitchView, { tData, user, tId }),
          view === 'draft' && React.createElement(DraftView, { tData, user, tId }),
          view === 'fixtures' && React.createElement(FixturesView, { tData }),
          view === 'stats' && React.createElement(StatsView, { tData }),
          view === 'admin' && React.createElement(AdminView, { tData, tId, onClose: () => setView('pitch') })
        ),
        // Nav
        React.createElement('nav', { className: 'fixed bottom-0 left-0 right-0 bg-black/90 border-t border-white/10 p-2 flex justify-around' },
          React.createElement(NavBtn, { active: view === 'pitch', icon: Lucide.Layout, label: 'Squad', onClick: () => setView('pitch') }),
          React.createElement(NavBtn, { active: view === 'draft', icon: Lucide.Users, label: 'Draft', onClick: () => setView('draft') }),
          React.createElement(NavBtn, { active: view === 'fixtures', icon: Lucide.Calendar, label: 'Fix', onClick: () => setView('fixtures') }),
          React.createElement(NavBtn, { active: view === 'stats', icon: Lucide.BarChart3, label: 'Stats', onClick: () => setView('stats') })
        )
      );
    }

    // --- SUB-COMPONENTS ---
    function NavBtn({ active, icon, label, onClick }) {
      return React.createElement('button', { onClick, className: `flex flex-col items-center p-2 ${active ? 'text-[#00E676]' : 'text-white/40'}` },
        React.createElement(icon, { size: 20 }),
        React.createElement('span', { className: 'text-[10px] uppercase font-bold mt-1' }, label)
      );
    }

    function LoginView({ onLogin }) {
      const [u, setU] = useState('');
      const [p, setP] = useState('');
      const handle = () => { if(u && p) onLogin({ username: u.toLowerCase() }); };
      return React.createElement('div', { className: 'h-screen flex items-center justify-center p-6' },
        React.createElement('div', { className: 'w-full max-w-sm glass p-8 rounded-3xl text-center' },
          React.createElement('h2', { className: 'text-3xl font-black italic uppercase mb-8' }, 'Fantasy App'),
          React.createElement('input', { placeholder: 'Username', className: 'w-full bg-white/5 p-4 rounded-xl mb-3', onChange: e => setU(e.target.value) }),
          React.createElement('input', { type: 'password', placeholder: 'Password', className: 'w-full bg-white/5 p-4 rounded-xl mb-6', onChange: e => setP(e.target.value) }),
          React.createElement('button', { onClick: handle, className: 'w-full bg-pitch-green text-black font-black py-4 rounded-xl uppercase' }, 'Enter Platform')
        )
      );
    }

    function GatewayView({ user, onJoin }) {
      const [chip, setChip] = useState('');
      const [name, setName] = useState('');
      const [pass, setPass] = useState('');
      const [mode, setMode] = useState('hub');

      const create = async () => {
        const id = Math.random().toString(36).substring(2, 8).toUpperCase();
        await set(ref(db, `tournaments/${id}`), { id, name, adminPassword: pass, owner: user.username });
        alert('Tournament Created! Your Chip: ' + id);
        setMode('hub');
      };

      const join = async () => {
        const id = chip.replace('#','').trim().toUpperCase();
        const snap = await get(ref(db, `tournaments/${id}`));
        if(snap.exists()) onJoin(id); else alert('Chip not found');
      };

      if (mode === 'create') return React.createElement('div', { className: 'p-8' },
        React.createElement('input', { placeholder: 'Tournament Name', className: 'w-full bg-white/5 p-4 mb-3 rounded-xl', onChange: e => setName(e.target.value) }),
        React.createElement('input', { placeholder: 'Admin Password', className: 'w-full bg-white/5 p-4 mb-4 rounded-xl', onChange: e => setPass(e.target.value) }),
        React.createElement('button', { onClick: create, className: 'w-full bg-pitch-green text-black font-bold p-4 rounded-xl uppercase' }, 'Launch')
      );

      return React.createElement('div', { className: 'h-screen flex flex-col items-center justify-center p-6 gap-4' },
        React.createElement('input', { placeholder: '#CHIP-CODE', className: 'bg-white/5 p-6 rounded-2xl text-center text-3xl font-black w-full', onChange: e => setChip(e.target.value) }),
        React.createElement('button', { onClick: join, className: 'w-full bg-pitch-green text-black font-bold p-4 rounded-xl uppercase' }, 'Join League'),
        React.createElement('button', { onClick: () => setMode('create'), className: 'text-white/40 uppercase font-bold text-xs' }, 'Or Create New Tournament')
      );
    }

    function PitchView({ tData, user, tId }) {
      const squad = tData?.users?.[user.username]?.squad || [];
      const isLocked = tData?.users?.[user.username]?.isLocked;

      const confirmSquad = async () => {
        if(squad.length !== 9) return alert('Need exactly 9 players');
        await update(ref(db, `tournaments/${tId}/users/${user.username}`), { isLocked: true });
      };

      return React.createElement('div', null,
        React.createElement('div', { className: 'relative aspect-[3/4] bg-[#0a2f15] rounded-3xl border-4 border-white/10 mb-6 flex flex-col justify-around p-4' },
          React.createElement('h3', { className: 'text-center text-[10px] font-bold text-white/20 uppercase tracking-widest' }, 'Main Squad'),
          squad.map((pId) => React.createElement('div', { key: pId, className: 'bg-white/10 p-2 rounded text-center text-xs' }, tData?.players?.[pId]?.name || pId))
        ),
        !isLocked && squad.length === 9 && React.createElement('button', { onClick: confirmSquad, className: 'w-full bg-pitch-green text-black font-bold p-4 rounded-xl mb-4' }, 'Confirm & Lock Team'),
        isLocked && React.createElement('div', { className: 'text-center p-4 bg-yellow-500/20 text-yellow-500 font-bold rounded-xl' }, 'ROSTER LOCKED')
      );
    }

    function DraftView({ tData, user, tId }) {
      const isLocked = tData?.users?.[user.username]?.isLocked;
      const [search, setSearch] = useState('');
      const players = Object.values(tData?.players || {});

      const togglePlayer = async (pid) => {
        if(isLocked) return;
        let squad = tData?.users?.[user.username]?.squad || [];
        if(squad.includes(pid)) squad = squad.filter(id => id !== pid);
        else if(squad.length < 9) squad.push(pid);
        await set(ref(db, `tournaments/${tId}/users/${user.username}/squad`), squad);
      };

      return React.createElement('div', null,
        React.createElement('input', { placeholder: 'Search Players...', className: 'w-full bg-white/5 p-4 rounded-xl mb-4', onChange: e => setSearch(e.target.value) }),
        players.filter(p => p.name.toLowerCase().includes(search.toLowerCase())).map(p => 
          React.createElement('div', { key: p.id, className: 'bg-white/5 p-4 rounded-xl mb-2 flex justify-between items-center' },
            React.createElement('div', null, React.createElement('p', { className: 'font-bold' }, p.name), React.createElement('p', { className: 'text-[10px] text-white/40' }, p.position)),
            React.createElement('button', { onClick: () => togglePlayer(p.id), disabled: isLocked, className: `px-4 py-2 rounded-lg text-xs font-bold ${isLocked ? 'opacity-20' : 'bg-white/10'}` }, 
              (tData?.users?.[user.username]?.squad || []).includes(p.id) ? 'REMOVE' : 'ADD'
            )
          )
        )
      );
    }

    function FixturesView({ tData }) {
      return React.createElement('div', null, 'Fixtures will appear here once Admin sets a match.');
    }

    function StatsView({ tData }) {
      return React.createElement('div', null, 'Leaderboards and top scorers will be displayed here.');
    }

    function AdminView({ tData, tId, onClose }) {
      const [auth, setAuth] = useState(false);
      const [pass, setPass] = useState('');
      const [pName, setPName] = useState('');

      const addP = async () => {
        const id = 'p_' + Date.now();
        await update(ref(db, `tournaments/${tId}/players/${id}`), { id, name: pName, points: 0, price: 5.0 });
        setPName('');
      };

      if (!auth) return React.createElement('div', null,
        React.createElement('input', { type: 'password', placeholder: 'Admin Pass', className: 'w-full bg-white/5 p-4 mb-4', onChange: e => setPass(e.target.value) }),
        React.createElement('button', { onClick: () => pass === tData.adminPassword ? setAuth(true) : alert('Wrong'), className: 'w-full bg-white/10 p-4' }, 'Unlock Admin')
      );

      return React.createElement('div', null,
        React.createElement('button', { onClick: onClose, className: 'mb-4 text-xs' }, 'BACK'),
        React.createElement('h2', { className: 'font-bold mb-4' }, 'Player Manager'),
        React.createElement('input', { value: pName, placeholder: 'New Player Name', className: 'w-full bg-white/5 p-4 mb-2', onChange: e => setPName(e.target.value) }),
        React.createElement('button', { onClick: addP, className: 'w-full bg-pitch-green text-black font-bold p-4' }, 'Add Player')
      );
    }

    // --- RENDER APP ---
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));

  </script>
</body>
</html>
